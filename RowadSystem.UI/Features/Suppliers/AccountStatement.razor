@page "/supplier-account-statement"

<div class="container-fluid px-3 animate__animated animate__fadeIn">
    <!-- Header Section -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
            <div class="d-flex align-items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-credit-card-2-back text-primary" viewBox="0 0 16 16">
                    <path d="M11 5.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5z" />
                    <path d="M2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm13 2v5H1V4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1m-1 9H2a1 1 0 0 1-1-1v-1h14v1a1 1 0 0 1-1 1" />
                </svg>
                <h4 class="mb-0 fw-bold text-dark">Account Statement</h4>
            </div>
            <div class="col-md-4">
                <RadzenDropDown Data="SupplierResponse"
                                TextProperty="Name"
                                ValueProperty="Id"
                                Placeholder="Select Supplier"
                                AllowClear="true"
                                Style="width:100%;"
                                FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                AllowFiltering="true"
                                ValueChanged="@((int value) => OnSupplierSelected(value))" />
            </div>
        </div>
    </div>

    <!-- Toolbar for Pagination -->
    <div class="card-header bg-white border-bottom py-3 px-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <!-- Rows Per Page Selector -->
            <div class="d-flex align-items-center gap-2">
                <label class="mb-0 text-muted">Rows:</label>
                <select class="form-select form-select-sm w-auto shadow-sm" @onchange="OnPageSizeChanged">
                    @foreach (var size in new[] { 5, 10, 20 })
                    {
                        <option value="@size" selected="@(PageSize == size)">@size</option>
                    }
                </select>
            </div>
        </div>
    </div>

    <!-- Account Statement Table -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                @if (IsLoading)
                {
                    <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
                        <button class="btn btn-primary" type="button" disabled>
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                            Loading...
                        </button>
                    </div>
                }
                else
                {
                    <table class="table table-hover align-middle text-center mb-0">
                        <thead class="bg-secondary text-white border-bottom border-3 border-white">
                            <tr>
                                <th class="py-3 px-2">#</th>
                                <th class="text-start py-3 px-3">Invoice Number</th>
                                <th class="text-start py-3 px-3">Invoice Date</th>
                                <th class="text-start py-3 px-3">Amount</th>
                                <th class="py-3 px-3">Payments</th>
                                <th class="py-3 px-3">Balance Due</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (_listResponse is not null)
                            {
                                @foreach (var statement in _listResponse.Items.Select((item, index) => new { item, index }))
                                {
                                    <tr>
                                        <td class="fw-semibold">@((statement.index + 1))</td>
                                        <td class="text-muted text-start">@statement.item.InvoiceNumber</td>
                                        <td class="text-muted text-start">@statement.item.InvoiceDate.ToString("yyyy-MM-dd")</td>
                                        <td class="text-muted text-start">@statement.item.Amount.ToString("C")</td>
                                        <td class="text-muted">@statement.item.Payments.ToString("C")</td>
                                        <td class="text-muted">@statement.item.BalanceDue.ToString("C")</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-center text-muted py-5">
                                        <i class="bi bi-file-earmark-x fs-4 text-danger"></i> No account statements found.
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>

            <!-- Pagination Below the Table -->
            <nav aria-label="Page navigation example" class="mt-3 d-flex justify-content-center">
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                        <button class="page-link d-flex align-items-center gap-1" @onclick="() => ChangePage(CurrentPage - 1)" aria-label="Previous">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                                <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z" />
                            </svg>
                            Prev
                        </button>
                    </li>

                    @for (int i = 1; i <= _listResponse.TotalPages; i++)
                    {
                        if (i == 1 || i == _listResponse.TotalPages || Math.Abs(i - CurrentPage) <= 1)
                        {
                            <li class="page-item @(CurrentPage == i ? "active" : "")">
                                <button class="page-link" @onclick="() => ChangePage(i)">@i</button>
                            </li>
                        }
                        else if (i == CurrentPage - 2 || i == CurrentPage + 2)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">…</span>
                            </li>
                        }
                    }

                    <li class="page-item @(CurrentPage == _listResponse.TotalPages ? "disabled" : "")">
                        <button class="page-link d-flex align-items-center gap-1" @onclick="() => ChangePage(CurrentPage + 1)" aria-label="Next">
                            Next
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                                <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z" />
                            </svg>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>
